name: CI

on: [push, pull_request]


jobs:
    lint:
        runs-on: ubuntu-latest
        steps:
            - name: Check out code
              uses: actions/checkout@v3
            - name: Set up Python
              uses: actions/setup-python@v4
              with:
                  python-version: "3.13"
            - name: Install dependencies
              run: |
                  python -m pip install --upgrade pip
                  pip install flake8
            

    tests:
        runs-on: ubuntu-latest
        needs: lint
        steps:
            - name: Check out code
              uses: actions/checkout@v3
            - name: Set up python
              uses: actions/setup-python@v4
              with:
                  python-version: "3.13"
            - name: Start redis
              uses: supercharge/redis-github-action@1.7.0
              with:
                  redis-version: "latest"
            - name: Install poetry
              run: |
                  curl -sSL https://install.python-poetry.org | python3 -
                  echo "$HOME/.local/bin" >> $GITHUB_PATH
            - name: Install dependencies
              run: poetry install
            - name: Load .env file
              run: |
                  if [ -f .env ]; then
                    export $(cat .env | xargs)
                  fi
            - name: Run tests
              run: poetry run python manage.py test #ntcn

#  deploy:
#    runs-on: ubuntu-latest
#    needs: test
#    if: success()
#
#    steps:
#      - name: Checkout code
#        uses: actions/checkout@v2
#
#      - name: Deploy to server
#        run: |
#          ssh root@85.92.111.109"cd /path/to/your/app && git pull && poetry install && sudo systemctl restart your_service"
#        env:
#          SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}